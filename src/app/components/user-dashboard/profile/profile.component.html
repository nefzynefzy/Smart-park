<main class="container mx-auto px-4 py-8">
  <!-- Profile Header -->
  <div class="bg-white rounded-lg p-8 mb-8 shadow-lg">
    <div class="flex flex-col md:flex-row items-center md:items-start gap-8">
      <div class="flex flex-col items-center">
        <div class="w-32 h-32 rounded-full bg-gray-100 overflow-hidden border-4 border-primary">
          <img
            src="https://readdy.ai/api/search-image?query=professional%20portrait%20of%20a%20French%20person%2C%20neutral%20expression%2C%20business%20attire%2C%20high%20quality%2C%20studio%20lighting%2C%20professional%20headshot&width=128&height=128&seq=profile1&orientation=squarish"
            alt="Photo de profil"
            class="w-full h-full object-cover object-top"
          />
        </div>
        <button
          class="mt-4 bg-primary text-gray-900 font-medium px-4 py-2 rounded-button flex items-center gap-2 hover:bg-opacity-90 transition-colors whitespace-nowrap"
        >
          <div class="w-5 h-5 flex items-center justify-center">
            <i class="ri-camera-line"></i>
          </div>
          Changer la photo
        </button>
      </div>
      <div class="flex-1">
        <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-4">
          <div>
            <h2 class="text-3xl font-bold text-gray-900">{{ user().name }}</h2>
            <p class="text-gray-500">Membre depuis {{ user().memberSince }}</p>
          </div>
          <button
            (click)="toggleEdit()"
            class="mt-4 md:mt-0 bg-gray-100 text-gray-700 px-4 py-2 rounded-button flex items-center gap-2 hover:bg-gray-200 transition-colors whitespace-nowrap"
          >
            <div class="w-5 h-5 flex items-center justify-center">
              <i class="ri-edit-line"></i>
            </div>
            {{ isEditing() ? 'Annuler' : 'Modifier le profil' }}
          </button>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-6">
          <div class="bg-gray-50 rounded p-4">
            <div class="flex items-center gap-3 mb-2">
              <div class="w-10 h-10 rounded-full bg-primary bg-opacity-20 flex items-center justify-center text-primary">
                <i class="ri-car-line ri-lg"></i>
              </div>
              <div>
                <h3 class="font-medium text-gray-900">Véhicule principal</h3>
                <p class="text-gray-400 text-sm">
                  {{ user().vehicle }}
                </p>
              </div>
            </div>
          </div>
          <div class="bg-gray-50 rounded p-4">
            <div class="flex items-center gap-3 mb-2">
              <div class="w-10 h-10 rounded-full bg-primary bg-opacity-20 flex items-center justify-center text-primary">
                <i class="ri-bank-card-line ri-lg"></i>
              </div>
              <div>
                <h3 class="font-medium text-gray-900">Méthode de paiement</h3>
                <p class="text-gray-400 text-sm">
                  {{ user().paymentMethod }}
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
    <!-- Coordonnées -->
    <div class="lg:col-span-1">
      <div class="bg-white rounded-lg shadow-lg overflow-hidden">
        <div class="p-6 border-b border-gray-200">
          <h3 class="text-xl font-bold text-gray-900">Mes coordonnées</h3>
        </div>
        <div class="p-6 space-y-6">
          @if (isEditing()) {
            <form (ngSubmit)="saveChanges()">
              <div class="space-y-4">
                <div>
                  <label class="block text-sm text-gray-400 mb-1">Email</label>
                  <input
                    type="email"
                    [(ngModel)]="user().email"
                    name="email"
                    class="w-full px-4 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-primary focus:border-primary outline-none transition-colors"
                  />
                </div>
                <div>
                  <label class="block text-sm text-gray-400 mb-1">Téléphone</label>
                  <input
                    type="tel"
                    [(ngModel)]="user().phone"
                    name="phone"
                    class="w-full px-4 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-primary focus:border-primary outline-none transition-colors"
                  />
                </div>
                <div>
                  <label class="block text-sm text-gray-400 mb-1">Adresse</label>
                  <textarea
                    [(ngModel)]="user().address"
                    name="address"
                    class="w-full px-4 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-primary focus:border-primary outline-none transition-colors"
                  ></textarea>
                </div>
                <div>
                  <label class="block text-sm text-gray-400 mb-1">Permis de conduire</label>
                  <input
                    type="text"
                    [(ngModel)]="user().license"
                    name="license"
                    class="w-full px-4 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-primary focus:border-primary outline-none transition-colors"
                  />
                </div>
                <button
                  type="submit"
                  class="w-full bg-primary text-gray-900 px-4 py-3 rounded-button flex items-center justify-center gap-2 hover:bg-opacity-90 transition-colors mt-4 whitespace-nowrap"
                >
                  Enregistrer les modifications
                </button>
              </div>
            </form>
          } @else {
            <div class="flex items-start gap-4">
              <div class="w-10 h-10 flex items-center justify-center rounded-full bg-gray-100 text-primary">
                <i class="ri-mail-line ri-lg"></i>
              </div>
              <div>
                <p class="text-sm text-gray-400">Email</p>
                <p class="text-gray-900">{{ user().email }}</p>
              </div>
            </div>
            <div class="flex items-start gap-4">
              <div class="w-10 h-10 flex items-center justify-center rounded-full bg-gray-100 text-primary">
                <i class="ri-smartphone-line ri-lg"></i>
              </div>
              <div>
                <p class="text-sm text-gray-400">Téléphone</p>
                <p class="text-gray-900">{{ user().phone }}</p>
              </div>
            </div>
            <div class="flex items-start gap-4">
              <div class="w-10 h-10 flex items-center justify-center rounded-full bg-gray-100 text-primary">
                <i class="ri-map-pin-line ri-lg"></i>
              </div>
              <div>
                <p class="text-sm text-gray-400">Adresse</p>
                <p class="text-gray-900">{{ user().address }}</p>
              </div>
            </div>
            <div class="flex items-start gap-4">
              <div class="w-10 h-10 flex items-center justify-center rounded-full bg-gray-100 text-primary">
                <i class="ri-driving-license-line ri-lg"></i>
              </div>
              <div>
                <p class="text-sm text-gray-400">Permis de conduire</p>
                <p class="text-gray-900">{{ user().license }}</p>
              </div>
            </div>
            <button
              (click)="toggleEdit()"
              class="w-full bg-gray-100 text-gray-700 px-4 py-3 rounded-button flex items-center justify-center gap-2 hover:bg-gray-200 transition-colors mt-4 whitespace-nowrap"
            >
              <div class="w-5 h-5 flex items-center justify-center">
                <i class="ri-edit-line"></i>
              </div>
              Modifier mes coordonnées
            </button>
          }
        </div>
      </div>

      <div class="bg-white rounded-lg shadow-lg overflow-hidden mt-8">
        <div class="p-6 border-b border-gray-200">
          <h3 class="text-xl font-bold text-gray-900">Préférences</h3>
        </div>
        <div class="p-6 space-y-6">
          <div class="flex items-center justify-between">
            <div class="flex items-center gap-3">
              <div class="w-10 h-10 flex items-center justify-center rounded-full bg-gray-100 text-primary">
                <i class="ri-notification-3-line ri-lg"></i>
              </div>
              <div>
                <p class="text-gray-900">Notifications par email</p>
              </div>
            </div>
            <label class="relative inline-flex items-center cursor-pointer">
              <input
                type="checkbox"
                class="sr-only peer"
                [checked]="preferences().emailNotifications"
                (change)="toggleNotification('email')"
              />
              <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary"></div>
            </label>
          </div>
          <div class="flex items-center justify-between">
            <div class="flex items-center gap-3">
              <div class="w-10 h-10 flex items-center justify-center rounded-full bg-gray-100 text-primary">
                <i class="ri-smartphone-line ri-lg"></i>
              </div>
              <div>
                <p class="text-gray-900">Notifications SMS</p>
              </div>
            </div>
            <label class="relative inline-flex items-center cursor-pointer">
              <input
                type="checkbox"
                class="sr-only peer"
                [checked]="preferences().smsNotifications"
                (change)="toggleNotification('sms')"
              />
              <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary"></div>
            </label>
          </div>
          <div class="flex items-center justify-between">
            <div class="flex items-center gap-3">
              <div class="w-10 h-10 flex items-center justify-center rounded-full bg-gray-100 text-primary">
                <i class="ri-earth-line ri-lg"></i>
              </div>
              <div>
                <p class="text-gray-900">Langue</p>
              </div>
            </div>
            <div class="relative">
              <button
                class="bg-gray-100 text-gray-700 px-4 py-2 rounded-button flex items-center gap-2 hover:bg-gray-200 transition-colors whitespace-nowrap"
              >
                <span>{{ preferences().language }}</span>
                <div class="w-5 h-5 flex items-center justify-center">
                  <i class="ri-arrow-down-s-line"></i>
                </div>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Historique des réservations -->
    <div class="lg:col-span-2">
      <div class="bg-white rounded-lg shadow-lg overflow-hidden">
        <div class="p-6 border-b border-gray-200 flex justify-between items-center">
          <div>
            <h3 class="text-xl font-bold text-gray-900">Historique des réservations</h3>
            <p class="text-gray-400">{{ reservations().length }} réservations au total</p>
          </div>
        </div>
        <div class="p-4">
          <div class="flex overflow-x-auto mb-6 py-2 gap-2">
            <button
              (click)="filterReservations('all')"
              [class.bg-primary]="activeTab() === 'all'"
              [class.text-gray-900]="activeTab() === 'all'"
              [class.bg-gray-100]="activeTab() !== 'all'"
              [class.text-gray-700]="activeTab() !== 'all'"
              class="px-4 py-2 rounded-full font-medium whitespace-nowrap transition-colors"
            >
              Toutes
            </button>
            <button
              (click)="filterReservations('ongoing')"
              [class.bg-blue-100]="activeTab() === 'ongoing'"
              [class.text-blue-800]="activeTab() === 'ongoing'"
              [class.bg-gray-100]="activeTab() !== 'ongoing'"
              [class.text-gray-700]="activeTab() !== 'ongoing'"
              class="px-4 py-2 rounded-full font-medium whitespace-nowrap transition-colors"
            >
              En cours
            </button>
            <button
              (click)="filterReservations('upcoming')"
              [class.bg-yellow-100]="activeTab() === 'upcoming'"
              [class.text-yellow-800]="activeTab() === 'upcoming'"
              [class.bg-gray-100]="activeTab() !== 'upcoming'"
              [class.text-gray-700]="activeTab() !== 'upcoming'"
              class="px-4 py-2 rounded-full font-medium whitespace-nowrap transition-colors"
            >
              À venir
            </button>
            <button
              (click)="filterReservations('completed')"
              [class.bg-green-100]="activeTab() === 'completed'"
              [class.text-green-800]="activeTab() === 'completed'"
              [class.bg-gray-100]="activeTab() !== 'completed'"
              [class.text-gray-700]="activeTab() !== 'completed'"
              class="px-4 py-2 rounded-full font-medium whitespace-nowrap transition-colors"
            >
              Terminées
            </button>
            <button
              (click)="filterReservations('cancelled')"
              [class.bg-red-100]="activeTab() === 'cancelled'"
              [class.text-red-800]="activeTab() === 'cancelled'"
              [class.bg-gray-100]="activeTab() !== 'cancelled'"
              [class.text-gray-700]="activeTab() !== 'cancelled'"
              class="px-4 py-2 rounded-full font-medium whitespace-nowrap transition-colors"
            >
              Annulées
            </button>
          </div>
          <div class="space-y-4">
            @for (reservation of reservations(); track reservation.id) {
              @if (activeTab() === 'all' || activeTab() === reservation.status) {
                <div
                  class="reservation-card bg-white rounded-lg p-4 shadow"
                  [class.border-l-4]="true"
                  [class.border-blue-500]="reservation.status === 'ongoing'"
                  [class.border-yellow-500]="reservation.status === 'upcoming'"
                  [class.border-green-500]="reservation.status === 'completed'"
                  [class.border-red-500]="reservation.status === 'cancelled'"
                >
                  <div class="flex flex-col md:flex-row justify-between gap-4">
                    <div>
                      <div class="flex items-center">
                        <span
                          class="status-indicator"
                          [class.bg-blue-500]="reservation.status === 'ongoing'"
                          [class.bg-yellow-500]="reservation.status === 'upcoming'"
                          [class.bg-green-500]="reservation.status === 'completed'"
                          [class.bg-red-500]="reservation.status === 'cancelled'"
                        ></span>
                        <span
                          class="font-medium"
                          [class.text-blue-500]="reservation.status === 'ongoing'"
                          [class.text-yellow-500]="reservation.status === 'upcoming'"
                          [class.text-green-500]="reservation.status === 'completed'"
                          [class.text-red-500]="reservation.status === 'cancelled'"
                        >
                          {{ 
                            reservation.status === 'ongoing' ? 'En cours' :
                            reservation.status === 'upcoming' ? 'À venir' :
                            reservation.status === 'completed' ? 'Terminée' : 'Annulée'
                          }}
                        </span>
                      </div>
                      <h4 class="text-lg font-bold text-gray-900 mt-2">
                        {{ reservation.parking }}
                      </h4>
                      <p class="text-gray-500">{{ reservation.spot }}</p>
                      <div class="flex items-center gap-2 mt-2 text-gray-400">
                        <div class="w-4 h-4 flex items-center justify-center">
                          <i class="ri-time-line"></i>
                        </div>
                        <span>{{ reservation.date }}</span>
                      </div>
                    </div>
                    <div class="flex flex-col items-end justify-between">
                      <span class="text-xl font-bold text-gray-900">{{ reservation.price }}</span>
                      <div class="flex gap-2 mt-2">
                        @if (reservation.status === 'upcoming') {
                          <button
                            class="bg-gray-100 text-gray-700 px-4 py-2 rounded-button hover:bg-gray-200 transition-colors whitespace-nowrap"
                          >
                            Annuler
                          </button>
                        }
                        @if (reservation.status === 'completed' || reservation.status === 'cancelled') {
                          <button
                            class="bg-gray-100 text-gray-700 px-4 py-2 rounded-button hover:bg-gray-200 transition-colors whitespace-nowrap"
                          >
                            Facture
                          </button>
                        }
                        <button
                          class="bg-primary text-gray-900 px-4 py-2 rounded-button font-medium hover:bg-opacity-90 transition-colors whitespace-nowrap"
                        >
                          Voir détails
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              }
            }
          </div>
          <div class="mt-6 flex justify-center">
            <button
              class="bg-gray-100 text-gray-700 px-6 py-2 rounded-button hover:bg-gray-200 transition-colors whitespace-nowrap"
            >
              Voir plus de réservations
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</main>